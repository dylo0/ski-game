<!DOCTYPE html>
<html>
    <head>
        <title>Ski Game</title>
        <link rel="import" href="bower_components/paper-elements/paper-elements.html">
<!--        <script src="bower_components/platform/platform.js"></script>-->
        <link rel="stylesheet" type="text/css" href="style.css">
    </head>
    <body>
        <div class="game-buttons">
            <paper-button class="colored"> Test button </paper-button>

        </div>
        <canvas id="gamePanel"></canvas>
        <script>
            var canvas = document.getElementById('gamePanel');
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            var ctx = canvas.getContext('2d');
            var playersWidth = window.innerWidth / 20;
            var playersHeight = window.innerWidth / 10;


            var getPlayerInitialPosition = function () {
                var player = {};

                player.posx = window.innerWidth / 2;
                player.posy = window.innerHeight * 0.8;
                player.dir = -1;
                player.rotation = 0;

                return player;
            }


            var player = getPlayerInitialPosition();
            var velocity = 5;
            var currentHeight = 0;


            canvas.onclick = function () {
                player.dir *= -1;
            };



            var checkColision = function () {

            };


            var updatePlayerPosition = function (pos) {
                if (player.dir < 0 && player.posx <= 0 || player.dir > 0 && player.posx >= canvas.width) {
                    player.dir *= -1;
                }
                player.posx += player.dir * velocity;
            };

            var updatePlayerRotation = function (player) {
                if (player.dir < 0 ) {
                    if (player.rotation > -Math.PI/4) {
                        player.rotation -= Math.PI/16;
                    }
                } else {
                    if (player.rotation < Math.PI/4) {
                        player.rotation += Math.PI/16;
                    }
                }
            }
            var updateLevelPosition = function () {

            }

            var drawPlayer = function (player) {
                ctx.save();
                ctx.translate(player.posx, player.posy);
                ctx.rotate(player.rotation);
                ctx.fillStyle = '#cce6ea'
                ctx.fillRect(-playersWidth /2 , -playersHeight/2, playersWidth, playersHeight);
                ctx.restore();
            };

            var drawObstacles = [
                function (x1, x2, y) {
                    ctx.fillRect(x1, y, x2-x1, 40);
                }
            ]

            var drawLevel = function () {
                var y = 100;

                ctx.save();
                ctx.fillStyle = '#647f83'
                for (var i=0; i<5; i++) {
                    var type = translatedLevel[i][0] -1;
                    var obstacle1 = translatedLevel[i][1];
                    var obstacle2 = translatedLevel[i][2];

                    drawObstacles[type](obstacle1[0], obstacle1[1], canvas.height - y);

                    if (obstacle2) {
                        drawObstacles[type](obstacle2[0], obstacle2[1], canvas.height - y);
                    }

                    y += 300;
                }
                ctx.restore();
            }

            var update = function () {
                window.requestAnimationFrame(update)
                ctx.clearRect(0,0, canvas.width, canvas.height);
                updatePlayerPosition(player);
                updatePlayerRotation(player);
                updateLevelPosition();
                drawPlayer(player);
                drawLevel();
            };



            var translateLevel = function (level) {
                var translatedLvl = [];
                var translate = function (x) {
                    return x * window.innerWidth / 100;
                };

                for (var i=0; i<level.length; i++) {
                    var type = level[i][0];
                    var obstacle1 = level[i][1];
                    var obstacle2 = level[i][2];

                    obstacle1[0] = translate(obstacle1[0]);
                    obstacle1[1] = translate(obstacle1[1]);

                    if (obstacle2) {
                        obstacle2[0] = translate(obstacle2[0]);
                        obstacle2[1] = translate(obstacle2[1]);
                    }

                    translatedLvl.push([type, obstacle1, obstacle2]);
                }

                return translatedLvl;
            };

            // obstacle: [type, [x1, x2], *[x3, x4] ]
            var lvl = [
                [1, [0,50], [80,100]],
                [1, [50,100]],
                [1, [0,  50]],
                [1, [50,100]],
                [1, [0,  50]],
                [1, [50,100]],
                [1, [0,  50]],
                [1, [50,100]],
                [1, [0,  50]],
                [1, [50,100]],
                [1, [0,  50]],
                [1, [50,100]],
                [1, [0,  50]],
                [1, [50,100]],
                [1, [0,  50]],
                [1, [50,100]],
                [1, [0,  50]],
                [1, [50,100]],
                [1, [0,  50]],
                [1, [50,100]],
                [1, [0,  50]],
                [1, [50,100]]
            ];

            var translatedLevel = translateLevel(lvl);
            update();
        </script>
    </body>
</html>
